> 交易系统与钱包之间的对接的本质就是交易系统通过RPC等方式同步钱包之中的数据

### BTC系列钱包对接

#### 通过官方程序部署BTC钱包节点
1. 下载BTC Linux钱包并解压：[https://bitcoin.org/zh_CN/download](https://bitcoin.org/zh_CN/download)
2. 创建区块同步的文件夹blockData: `mkdir blockData`
3. 启动服务：`./bin/bitcoind -datadir=/home/blockData -server=1 -rpcuser=btc -rpcpassword=123456 -rpcport=10086 -rpcallowip=0.0.0.0/0`
4. 测试网添加参数`-testnet`，生产环境则默认不加。
5. 钱包运行需要打开防火墙，保证`10086`端口Java钱包服务可以访问到，云服务器需要在安全组进行配置，最安全的策略是在内网访问，不对外开放。

#### 通过Docker部署BTC测试节点
##### docker安装
1. 设置Docker存储库：`yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo`
2. 安装Docker-ce：`yum install -y docker-ce`, `docker -v`查看是否安装成功
3. 启动Docker-ce：`systemctl daemon-reload && systemctl start docker`

##### bitcoin-testnet-box安装
0. 在`https://www.docker.com/`中注册账号后输入命令登录账号：`docker login`
1. 拉取`bitcoin-testnet-box`镜像：`docker pull freewil/bitcoin-testnet-box`
2. 后台运行Docker镜像：`docker run -d --name btc-test-node -p 19001:19001 -p 19011:19011 freewil/bitcoin-testnet-box`
3. 进入Docker镜像：`docker exec -it your_container_id /bin/bash`
4. 启动bitcoin服务：`make start`

##### bitcoin-testnet-box命令基础
1. 查看节点信息：`make getinfo `
2. 获取节点对等信息：`bitcoin-cli -datadir=1 getpeerinfo`
3. 生成地址：`bitcoin-cli -datadir=1 getnewaddress`
4. 查看地址私钥：`bitcoin-cli -datadir=1 dumpprivkey your_address`
5. 生成区块：`bitcoin-cli -datadir=1 generate 1` ，最后指定的参数为区块数量，生成一百个区块后挖矿的coinbase奖励才能使用
6. 查询钱包信息：`bitcoin-cli -datadir=1 getwalletinfo`
7. 转账：`bitcoin-cli -datadir=1 sendtoaddress to_address amount`
8. 开启宿主机RPC访问，编辑1/bitcoin.conf文件，将”rpcallowip=0.0.0.0/0 rpcallowip=::/0”两个配置打开，然后`make stop`, `make start`重启

#### 钱包安全备份
1. 比特币默认创建的目录在`~/.bitcoin/`下，其中的`wallet.dat`则是钱包文件，这个是可以控制当前账户下所有比特币的文件
2. 只需要对`wallet.dat`文件进行复制备份就OK，比较好的办法是对其进行文件加密并保存到一个安全的地方

#### 钱包API
> 官方API文档：https://bitcoin.org/en/developer-reference#rpc-quick-reference

1. GetBalance：返回总共的可用余额
2. GetNewAddress：返回一个新的比特币地址以接收付款
3. ListTransactions：获取最近的交易列表
4. GetTransaction：根据txid获取交易详细信息
5. SendToAddress：向指定的比特币地址发送比特币
6. WalletLock：锁定钱包
7. WalletPassphrase：解锁钱包


#### 钱包API与交易系统交互

![aa](../../_media/btc_recharge_withdraw.png)



##### 公众号
![公众号](https://oss.whoiszxl.com/qrcode_for_whoisc137_258.jpg)